name: Play 2.3 Build

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set up Java 8
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'

      # Create local ivy2 folder so sbt can write here
      - name: Prepare Ivy2 Cache
        run: mkdir -p ./.ivy2

      # Compile the Play 2.3 application using the local activator launcher
      - name: Compile (Play 2.3)
        run: |
          chmod +x activator-launch-1.2.12.jar
          java \
            -Dactivator.home=. \
            -Dsbt.ivy.home=./.ivy2 \
            -Dsbt.override.build.repos=true \
            -Dsbt.repository.config=./project/repositories \
            -Doffline=true \
            -Xms512M -Xmx2G \
            -jar activator-launch-1.2.12.jar \
            compile

      # Create distribution package
      - name: Create Play Dist Package
        run: |
          java \
            -Dactivator.home=. \
            -Dsbt.ivy.home=./.ivy2 \
            -Dsbt.override.build.repos=true \
            -Dsbt.repository.config=./project/repositories \
            -Doffline=true \
            -Xms512M -Xmx2G \
            -jar activator-launch-1.2.12.jar \
            dist

      # Upload the ZIP artifact produced by the Play dist task
      - name: Upload Play Distribution
        uses: actions/upload-artifact@v4
        with:
          name: play23-dist
          path: target/universal/*.zip
