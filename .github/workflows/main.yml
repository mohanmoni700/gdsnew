name: Scala CI

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Java 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'

      - name: Install sbt
        run: |
          echo "Adding sbt repository..."
          echo "deb [signed-by=/usr/share/keyrings/sbt-keyring.gpg] https://repo.scala-sbt.org/scalasbt/debian all main" | sudo tee /etc/apt/sources.list.d/sbt.list
          curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x99E82A75642AC823" \
            | gpg --dearmor | sudo tee /usr/share/keyrings/sbt-keyring.gpg > /dev/null
          sudo apt-get update
          sudo apt-get install -y sbt

      - name: Add legacy Typesafe repositories (linter-safe)
        run: |
          mkdir -p ~/.sbt
          printf '%s\n' \
            '[repositories]' \
            'local' \
            'typesafe-ivy-releases: https://repo.typesafe.com/typesafe/ivy-releases/, [ivy]' \
            'typesafe-releases: https://repo.typesafe.com/typesafe/releases/' \
            'maven-central: https://repo1.maven.org/maven2/' \
            > ~/.sbt/repositories
          echo "Wrote ~/.sbt/repositories:"
          sed -n '1,120p' ~/.sbt/repositories

      - name: Verify sbt version
        run: sbt sbt-version

      - name: Build Play application
        run: sbt clean dist
